"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Pythagorean(t,e,n,i){return console.log("p1x: ",t,"p1y",e,"p2x ",n,"p2y",i),Math.sqrt(Math.pow(t-n,2)+Math.pow(e-i,2))}function Pythagorean(t,e){return Math.sqrt(Math.pow(t,2)+Math.pow(e,2))}function Slope(t,e,n,i){return(e-i)/(t-n)}function calcAngle(t,e){var n=t.y-e.y,i=t.x-e.x,s=Math.atan(n/i)*(180/Math.PI);return s+=i<0?180:0}function shuffle(t){for(var e,n,i=t.length;0!==i;)n=Math.floor(Math.random()*i),e=t[i-=1],t[i]=t[n],t[n]=e;return t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function t(t,e){var n=[],i=!0,s=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done)&&(n.push(r.value),!e||n.length!==e);i=!0);}catch(t){s=!0,o=t}finally{try{!i&&a.return&&a.return()}finally{if(s)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),State=function(){function t(){_classCallCheck(this,t),this._states=["place","sell","info"],this._state=0}return _createClass(t,[{key:"addState",value:function(t){-1==this._states.indexOf(t)&&this._states.push(t)}},{key:"state",set:function(t){var e=this._states.indexOf(t);e>=0&&(this._state=e)},get:function(){return this._states[this._state]}}]),t}(),Collider=function(){function t(){_classCallCheck(this,t)}return _createClass(t,[{key:"update",value:function(t,e,n,i,s){e=e.filter(function(e){return!!e.AI.target&&(e.move(t),!e.done||(e.target&&e.target.health.takeDamage(e.damage.damage),!1))});var o=!0,r=!1,a=void 0;try{for(var h,l=i[Symbol.iterator]();!(o=(h=l.next()).done);o=!0){var c=h.value;if(c.update(t),c.ready){var u=9999,_=null,f=9999,y=!0,g=!1,v=void 0;try{for(var d,m=n[Symbol.iterator]();!(y=(d=m.next()).done);y=!0){var p=d.value;(f=Math.sqrt(Math.pow(Math.floor(c.position.x-p.position.x),2)+Math.pow(c.position.y-p.position.y,2)))<u&&(u=f,_=p)}}catch(t){g=!0,v=t}finally{try{!y&&m.return&&m.return()}finally{if(g)throw v}}u<=c.range&&e.push(c.fire(_))}}}catch(t){r=!0,a=t}finally{try{!o&&l.return&&l.return()}finally{if(r)throw a}}return n=n.filter(function(e){return e.AI.target&&e.health.alive()?(e.move(t),!e.done||(0!=e.AI.target.pathValue?(e.AI.target=e.AI.target._prev,e._done=!1,!0):(e.target&&s.health.takeDamage(e.damage.damage),!1))):(s.money.deposit(e.money.money),s.kills++,!1)}),[e,n]}}]),t}(),Game=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:400,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:400,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new Player,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new State;_classCallCheck(this,t),this._projectiles=[],this._enemies=[],this._collider=new Collider,this._map=new Map(e,n,i,s),this._player=o,this._state=r,this._opponent=new opponentNPCAI(this)}return _createClass(t,[{key:"update",value:function(t){var e=this._collider.update(t,this._projectiles,this._enemies,this.towers,this._player),n=_slicedToArray(e,2);this._projectiles=n[0],this._enemies=n[1],this._opponent.update(t)}},{key:"step",value:function(t){this.update(t)}},{key:"onclick",value:function(t){if(t.state){if("place"==this._state.state){var e=Math.floor(this._map.rows*t.y),n=Math.floor(this._map.cols*t.x),i=new TinyTower(this._map._tiles[e][n].position.x,this._map._tiles[e][n].position.y);i.cost.money<=this._player.money.money&&this._player.money.withdraw(this._map.insertTower(t.y,t.x,i))}"sell"==this._state.state&&this._player.money.deposit(this._map.removeTower(t.y,t.x))}}},{key:"state",get:function(){return this._state},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"sell";this._state=t}},{key:"player",get:function(){return this._player},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._player=t}},{key:"projectiles",get:function(){return this._projectiles},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._projectiles=t}},{key:"towers",get:function(){return this._map.towers}},{key:"enemies",get:function(){return this._enemies},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._enemies=t}}]),t}(),DEBUG=!0,LAST=Date.now(),ELAPSED=0,scene,game,clickhandler,player,state,cc,canvas,stats;$(function(){function t(){ELAPSED=Date.now()-LAST,LAST+=ELAPSED,ELAPSED>1e3&&(ELAPSED=1e3/30,LAST=Date.now()),game.step(ELAPSED),scene.animate(game),stats.update(),window.requestAnimationFrame(t)}state=new State,cc=new CanvasContainer(state,"canvasContainer"),canvas=cc.canvas,player=new Player,game=new Game(15,15,canvas.height,canvas.width,player,state),clickhandler=new MouseHandler(canvas,game),scene=new Animator(canvas,game),stats=new StatWatcher(game),window.requestAnimationFrame(t)});var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Animator=function(){function t(e,n){_classCallCheck(this,t),this._game=n,this._canvas=e,this._context=e.getContext("2d"),this._colorkeys={Begin:"black",Sheep:"#CCCCCC",Wolf:"#BBBBBB",Unicorn:"#AAAAAA",Sealion:"#FABE19",Bear:"#55BB99","Armored Bear":"#55BB99","Small Enemy":"#55BB99","Feisty Enemy":"#55BB99",Gorgon:"#55BB99",Cyclops:"#55BB99",Titan:"#55BB99","Little Sister":"#55BB99","The Dinyyen":"#338844","The Toto-Baggins":"#55BB99","Tough Guy":"#55BB99",TinyEnemy:"#55BB99"}}return _createClass(t,[{key:"update",value:function(t){var e=this._canvas.width/this._game._map._cols,n=this._canvas.height/this._game._map._rows,i=this._game._map._rows,s=this._game._map._cols;this._context.fillRect(0,0,this._canvas.width,this._canvas.height);for(var o=0;o<i;o++)for(var r=0;r<s;r++)this._context.fillStyle=null!=this._game._map._tiles[o][r].tower?"lightgray":"white",this._context.fillRect(r*e-1,o*n-1,e+1,n+1);this._context.beginPath(),this._context.strokeStyle="lime",this._context.rect(this._game._map.begin.col*e,this._game._map.begin.row*n,e,n),this._context.stroke(),this._context.beginPath(),this._context.strokeStyle="red",this._context.rect(this._game._map.end.col*e,this._game._map.end.row*n,e,n),this._context.stroke();var a=!0,h=!1,l=void 0;try{for(var c,u=this._game.enemies[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var _=c.value,f=_.position.x,y=_.position.y;this._context.fillStyle=this._colorkeys[_.name]||"lightgreen",this._context.fillRect(f-5,y-5,10,10),this._context.fillStyle="black",this._context.fillRect(f-6,y-9,12,3),this._context.fillStyle="red",this._context.fillRect(f-6,y-8,Math.floor(12*_.health.howdead),2)}}catch(t){h=!0,l=t}finally{try{!a&&u.return&&u.return()}finally{if(h)throw l}}var g=!0,v=!1,d=void 0;try{for(var m,p=this._game.towers[Symbol.iterator]();!(g=(m=p.next()).done);g=!0){var w=m.value,f=w.position.x,y=w.position.y;this._context.fillStyle="black",this._context.fillRect(f-10,y-10,20,20)}}catch(t){v=!0,d=t}finally{try{!g&&p.return&&p.return()}finally{if(v)throw d}}var k=!0,C=!1,b=void 0;try{for(var x,T=this._game.projectiles[Symbol.iterator]();!(k=(x=T.next()).done);k=!0){var S=x.value,f=S.position.x,y=S.position.y;this._context.fillStyle="red",this._context.fillRect(f-2,y-2,4,4)}}catch(t){C=!0,b=t}finally{try{!k&&T.return&&T.return()}finally{if(C)throw b}}}},{key:"animate",value:function(t){this.update(t)}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),CanvasContainer=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"canvasContainer";_classCallCheck(this,t),this._state=e,this._canvas=document.getElementById(n).getElementsByTagName("canvas")[0],this._cc=document.getElementById(n).getBoundingClientRect(),this._canvas.width=this._cc.width-6,this._canvas.height=this._cc.height,this.addListenersToButtons()}return _createClass(t,[{key:"addListenersToButtons",value:function(){for(var t=document.getElementById("selectors").getElementsByTagName("li"),e=0,n=t.length;e<n;e++)t[e].addEventListener("click",function(t){if(-1==t.target.className.indexOf("selected")){var e=document.querySelectorAll(".selected")[0];e&&(e.className=e.className.replace(/selected/i,"")),t.target.className+=" selected",state.state=t.target.id,"info"==t.target.id&&-1==t.target.innerHTML.indexOf("info")?t.target.innerHTML="Click place to<br>buy towers.<br>Click sell to<br>remove them.":(state.state="info"==t.target.id)&&(t.target.innerHTML="Sorry, this<br>doesn't do<br>anything.")}else t.target.className=t.target.className.replace(/selected/i,"")})}},{key:"canvas",get:function(){return this._canvas}}]),t}(),StatWatcher=function(){function t(e){_classCallCheck(this,t),this._game=e,this._stats={};for(var n=["money","health","kills","enemyname","enemyhealth","enemyspawnrate"],i=0;i<n.length;i++){var s=n[i];this._stats[s]=document.getElementById(s)}this.update()}return _createClass(t,[{key:"update",value:function(){this._stats.money.innerHTML=Math.floor(this._game.player.money.money),this._stats.health.innerHTML=Math.floor(this._game.player.health.health),this._stats.kills.innerHTML=this._game.player.kills,this._stats.enemyname.innerHTML=this._game._opponent._stages[this._game._opponent._currentStage][0],this._stats.enemyhealth.innerHTML=this._game._opponent._em[this._game._opponent._stages[this._game._opponent._currentStage][0]].health,this._stats.enemyspawnrate.innerHTML=this._game._opponent._stages[this._game._opponent._currentStage][1]}}]),t}(),_slicedToArray=function(){function t(t,e){var n=[],i=!0,s=!1,o=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done)&&(n.push(r.value),!e||n.length!==e);i=!0);}catch(t){s=!0,o=t}finally{try{!i&&a.return&&a.return()}finally{if(s)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Entity=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";_classCallCheck(this,t),this._name=e}return _createClass(t,[{key:"name",get:function(){return this._name},set:function(t){this._name=t}}]),t}(),Position=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,t),this._x=e,this._y=n}return _createClass(t,[{key:"close",value:function(t){return console.log("ubsude otherpose"),PythagoreanObj(this.position,t.position)<1}},{key:"close",value:function(t,e){return Pythagorean(this._x,this._y,t,e)<1}},{key:"x",get:function(){return this._x},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._x=t}},{key:"y",get:function(){return this._y},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._y=t}},{key:"position",get:function(){return{x:this._x,y:this._y}}}]),t}(),Velocity=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,t),this._x=e,this._y=n}return _createClass(t,[{key:"x",get:function(){return this._x},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._x=t}},{key:"y",get:function(){return this._y},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._y=t}}]),t}(),Damage=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;_classCallCheck(this,t),this._damage=e}return _createClass(t,[{key:"damage",get:function(){return this._damage},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._damage=t}}]),t}(),Money=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.75;_classCallCheck(this,t),this._money=e,this._refundRatio=n,this._created=Date.now()}return _createClass(t,[{key:"deposit",value:function(t){"number"==typeof t&&(this._money+=t)}},{key:"withdraw",value:function(t){if("number"==typeof t)return!(t>this._money)&&(this._money-=t,this._money)}},{key:"money",get:function(){return this._money},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._money=t>=0?t:0}},{key:"refund",get:function(){return this._money*(Date.now()-this._created>6e4?this._refundRatio:1)}}]),t}(),AI=function t(){_classCallCheck(this,t)},TowerAI=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,AI),e}(),HomingAI=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n._target=t,n._angle=0,n}return _inherits(e,AI),_createClass(e,[{key:"move",value:function(t,e,n,i){var s=Math.PI/180,o=Math.sqrt(Math.pow(t-this._target.position.x,2)+Math.pow(e-this._target.position.y,2));this._angle=s*calcAngle({x:this._target.position.x,y:this._target.position.y},{x:t,y:e});var r=Math.cos(this._angle)*n*i/1e3,a=Math.sin(this._angle)*n*i/1e3,h=Pythagorean(r,a);return h>o&&(r/=h/o,a/=h/o),[t+r,e+a,o<1]}},{key:"angle",get:function(){return this._angle},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._angle=t}},{key:"target",get:function(){return this._target},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._target=t}}]),e}(),Tower=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:750,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:10;arguments.length>6&&void 0!==arguments[6]&&arguments[6];_classCallCheck(this,t),this._position=new Position(e,n),this._range=i,this._cooldown=s,this._lastFired=Date.now(),this._ready=!0,this._projectile=o,this._health=new Health,this._target=null,this._cost=new Money(r)}return _createClass(t,[{key:"update",value:function(t){this._lastFired+=t,this._ready=this._lastFired>this._cooldown}},{key:"fire",value:function(t){return!!this._ready&&(this._target=t,this._lastFired=0,this._ready=!1,this._projectile(this.position.x,this.position.y,t))}},{key:"cost",get:function(){return this._cost},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;this._cost=t}},{key:"health",get:function(){return this._health},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;this._health=t}},{key:"position",get:function(){return this._position},set:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._position=t}},{key:"ready",get:function(){return this._ready},set:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._ready=t}},{key:"range",get:function(){return this._range},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;this._range=t}},{key:"lastFired",get:function(){return this._lastFired},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._lastFired=t}},{key:"cooldown",get:function(){return this._cooldown},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._cooldown=t}},{key:"target",get:function(){return this._target},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._target=t}}]),t}(),Health=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;_classCallCheck(this,t),this._max=e,this._health=e}return _createClass(t,[{key:"takeDamage",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._health-=t}},{key:"alive",value:function(){return this._health>0}},{key:"howdead",get:function(){return this._health/this._max}},{key:"max",get:function(){return this._max},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;this._max=t}},{key:"health",get:function(){return this._health},set:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;this._health=t}}]),t}(),HomingBullet=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:5,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:100,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:"";_classCallCheck(this,e);var u=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c));return u._position=new Position(t,n),u._vel=new Velocity(i,s),u._AI=new HomingAI(o),u._speed=r,u._done=!1,u._damage=new Damage(a),u._health=new Health(h),u._money=new Money(l),u}return _inherits(e,Entity),_createClass(e,[{key:"move",value:function(t){var e=this._AI.move(this._position.x,this._position.y,this._speed,t),n=_slicedToArray(e,3);this._position.x=n[0],this._position.y=n[1],this._done=n[2]}},{key:"money",get:function(){return this._money},set:function(t){this._money=t}},{key:"target",get:function(){return this._AI.target},set:function(t){this._AI.target=t}},{key:"health",get:function(){return this._health},set:function(t){this._health=t}},{key:"done",get:function(){return this._done},set:function(t){this._done=t}},{key:"speed",get:function(){return this._speed},set:function(t){this._speed=t}},{key:"damage",get:function(){return this._damage},set:function(t){this._damage=t}},{key:"position",get:function(){return this._position}},{key:"vel",get:function(){return this._vel}},{key:"AI",get:function(){return this._AI}}]),e}(),TinyBullet=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments[2];return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,0,0,i,60,5,100))}return _inherits(e,HomingBullet),e}(),TinyEnemy=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments[2];return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,0,0,i,20,5,100,2))}return _inherits(e,HomingBullet),e}(),TinyTower=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:141,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3e3,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments[2];return new TinyBullet(t,e,n)},r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:10;arguments.length>6&&void 0!==arguments[6]&&arguments[6];_classCallCheck(this,e);var a=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,i,s,o,r));return a._AI=new TowerAI,a}return _inherits(e,Tower),_createClass(e,[{key:"AI",get:function(){return this._AI}}]),e}(),Player=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;_classCallCheck(this,t),this._health=new Health(e),this._money=new Money(n),this._kills=0}return _createClass(t,[{key:"kills",get:function(){return this._kills},set:function(t){this._kills=t}},{key:"money",get:function(){return this._money},set:function(t){this._money=t}},{key:"health",get:function(){return this._health},set:function(t){this._health=t}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),MouseHandler=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,t),this._mouse={x:0,y:0,state:0},this._canvas=e,this._rect,this.init(e),this._listeners=[],n&&this.registerListener(n)}return _createClass(t,[{key:"registerListener",value:function(t){this._listeners.push(t)}},{key:"removeListener",value:function(t){this._listeners=this._listeners.filter(function(e){return e!=t})}},{key:"emit",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,s=this._listeners[Symbol.iterator]();!(t=(i=s.next()).done);t=!0)i.value.onclick(this.mouseratio)}catch(t){e=!0,n=t}finally{try{!t&&s.return&&s.return()}finally{if(e)throw n}}}},{key:"_updateMousePosition",value:function(t){this._rect=this._canvas.getBoundingClientRect(),this._mouse.x=(t.clientX-this._rect.left)/(this._rect.right-this._rect.left)*this._canvas.width,this._mouse.y=(t.clientY-this._rect.top)/(this._rect.bottom-this._rect.top)*this._canvas.height}},{key:"init",value:function(t){var e=this;$("canvas").on("click",function(t){e._mouse.state=0,e._updateMousePosition(t),e.emit()}).on("mousedown",function(t){e._mouse.state=1,e._updateMousePosition(t),e.emit()}).on("mouseup",function(t){e._mouse.state=0,e._updateMousePosition(t),e.emit()}).on("mousemove",function(t){e._updateMousePosition(t),e.emit()})}},{key:"mouse",get:function(){return this._mouse}},{key:"mouseratio",get:function(){return{x:this._mouse.x/this._canvas.width,y:this._mouse.y/this._canvas.width,state:this._mouse.state}}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),Tile=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;_classCallCheck(this,t),this._row=e,this._col=n,this._next=null,this._prev=null,this._bits=0,this._pathValue=0,this._position=new Position,this._checked=!1,this._tower=null,this._changed=Date.now()-6e4,s&&i&&this.calcCenter(i,s)}return _createClass(t,[{key:"sell",value:function(){var t=Date.now();if(t-this._changed<1e3)return!1;var e=this._tower?this._tower.cost.refund:null;return this._tower=null,this._changed=t,e}},{key:"calcCenter",value:function(t,e){this._position.x=this._col*e+e/2,this._position.y=this._row*t+t/2}},{key:"position",get:function(){return this._position}},{key:"checked",get:function(){return this._checked},set:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._checked=t}},{key:"row",get:function(){return this._row},set:function(t){this._row=t}},{key:"tower",get:function(){return this._tower},set:function(t){var e=Date.now();return!(e-this._changed<1e3)&&(this._tower=t,this._changed=e,!0)}},{key:"col",get:function(){return this._col},set:function(t){this._col=t}},{key:"next",get:function(){return this._next},set:function(t){this._next=t}},{key:"prev",get:function(){return this._prev},set:function(t){this._prev=t}},{key:"bits",get:function(){return this._bits},set:function(t){this._bits=t}},{key:"pathValue",get:function(){return this._pathValue},set:function(t){this._pathValue=t}}]),t}(),Map=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:400,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:400,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;_classCallCheck(this,t),this._tiles=[],this._rows=e,this._cols=n,this._maph=i,this._mapw=s,this.UP=8,this.RIGHT=4,this.DOWN=2,this.LEFT=1,this.ALL=15,this.NONE=0;for(var a=0;a<e;a++){this._tiles[a]=new Array(n);for(var h=0;h<n;h++)this._tiles[a][h]=new Tile(a,h,i/e,s/n)}this._begin=o?this._tiles[o.row][o.col]:this._tiles[0][0],this._end=r?this._tiles[r.row][r.col]:this._tiles[e-1][n-1],this.calculatePathing()}return _createClass(t,[{key:"resize",value:function(t,e){this._maph=t,this._mapw=e;var n=!0,i=!1,s=void 0;try{for(var o,r=this._tiles[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var a=o.value,h=!0,l=!1,c=void 0;try{for(var u,_=a[Symbol.iterator]();!(h=(u=_.next()).done);h=!0){var f=u.value;f.calcCenter(t,e),f.tower&&(f.tower.position.x=f.position.x,f.tower.position.y=f.position.y)}}catch(t){l=!0,c=t}finally{try{!h&&_.return&&_.return()}finally{if(l)throw c}}}}catch(t){i=!0,s=t}finally{try{!n&&r.return&&r.return()}finally{if(i)throw s}}}},{key:"insertTower",value:function(t,e,n){(t%1||e%1)&&(t=Math.floor(this._rows*t),e=Math.floor(this._cols*e));var i=this.tiles[t][e]._tower,s=this._tiles[t][e].tower=n;return this.calculatePathing()?!!s&&(null==i?n.cost.money:n.cost.money-i.cost.refund):(console.log("PATHING FAILED!"),this._tiles[t][e]._tower=null,this.calculatePathing(),!1)}},{key:"removeTower",value:function(t,e){(t%1||e%1)&&(t=Math.floor(this._rows*t),e=Math.floor(this._cols*e));var n=this.tiles[t][e].sell();return this.calculatePathing(),n}},{key:"calcdirections",value:function(){for(var t=0;t<this._rows;t++)for(var e=0;e<this._cols;e++){var n=this._tiles[t][e];n.bits&=this.NONE,e!=this._cols-1&&null==this._tiles[t][e+1].tower&&(n.bits^=this.RIGHT),0!=e&&null==this._tiles[t][e-1].tower&&(n.bits^=this.LEFT),0!=t&&null==this._tiles[t-1][e].tower&&(n.bits^=this.UP),t!=this._rows-1&&null==this._tiles[t+1][e].tower&&(n.bits^=this.DOWN)}}},{key:"calcpathcosts",value:function(){arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._begin;var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._end,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._tiles,n=!0,i=!1,s=void 0;try{for(var o,r=this._tiles.reduce(function(t,e){return t.concat(e)})[Symbol.iterator]();!(n=(o=r.next()).done);n=!0){var a=o.value;a._pathValue=9999,a.checked=!1}}catch(t){i=!0,s=t}finally{try{!n&&r.return&&r.return()}finally{if(i)throw s}}e[t.row][t.col]._pathValue=0;for(var h=[e[t.row][t.col]],l=Math.sqrt(2),c=function(t,e,n,i){e.tower||(e.pathValue=e.pathValue<t.pathValue+i?e.pathValue:t.pathValue+i),e.checked||e.tower||n.push(e)};h.length;){var u=h.pop();u.checked=!0,u.bits&this.RIGHT&&c(u,this._tiles[u._row][u._col+1],h,1),u.bits&this.LEFT&&c(u,this._tiles[u._row][u._col-1],h,1),u.bits&this.UP&&c(u,this._tiles[u._row-1][u._col],h,1),u.bits&this.DOWN&&c(u,this._tiles[u._row+1][u._col],h,1),u.bits&this.UP&&u.bits&this.LEFT&&c(u,this._tiles[u._row-1][u._col-1],h,l),u.bits&this.UP&&u.bits&this.RIGHT&&c(u,this._tiles[u._row-1][u._col+1],h,l),u.bits&this.DOWN&&u.bits&this.RIGHT&&c(u,this._tiles[u._row+1][u._col+1],h,l),u.bits&this.DOWN&&u.bits&this.LEFT&&c(u,this._tiles[u._row+1][u._col-1],h,l)}}},{key:"link",value:function(){var t=!0,e=!1,n=void 0;try{for(var i,s=this._tiles.reduce(function(t,e){return t.concat(e)})[Symbol.iterator]();!(t=(i=s.next()).done);t=!0){for(var o=i.value,r=9999,a={row:0,col:0},h=-1;h<=1;h++)for(var l=-1;l<=1;l++)if(h||l){var c,u=o._row+h,_=o._col+l;u>=0&&u<this._rows&&_>=0&&_<this._cols&&(c=this._tiles[u][_]._pathValue,(h!=l&&h+l!=0||null==this._tiles[o._row][o._col+l].tower)&&null==this._tiles[o._row+h][o._col].tower&&c<r&&(r=c,a={row:u,col:_}))}o._prev=this._tiles[a.row][a.col],this._tiles[a.row][a.col]._next=o}}catch(t){e=!0,n=t}finally{try{!t&&s.return&&s.return()}finally{if(e)throw n}}}},{key:"calculatePathing",value:function(){return this.calcdirections(),this.calcpathcosts(),this.link(),9999!=this.begin.prev.pathValue}},{key:"tiles",get:function(){return this._tiles}},{key:"begin",set:function(t){this._begin=t},get:function(){return this._begin}},{key:"cols",set:function(t){this._cols=t},get:function(){return this._cols}},{key:"rows",set:function(t){this._rows=t},get:function(){return this._rows}},{key:"end",set:function(t){this._end=t},get:function(){return this._end}},{key:"towers",get:function(){return this._tiles.reduce(function(t,e){return t.concat(e)}).filter(function(t){return t.tower}).map(function(t){return t.tower})}}]),t}(),_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),opponentNPCAI=function(){function t(e){_classCallCheck(this,t),this._game=e,this._elapsed=0,this._spawnEnemyRate=7500,this._em=new EnemyFactory(this._game._map._begin),this._stages=[["Begin",1e4,1],["Sheep",250,60],["Wolf",850,30],["Unicorn",1250,20],["Sealion",1300,15],["Bear",1350,24],["Armored Bear",2e3,12],["Small Enemy",2500,20],["Feisty Enemy",2250,30],["Gorgon",2150,30],["Cyclops",2100,30],["Titan",2050,30],["Little Sister",1e3,10],["The Dinyyen",2e3,20],["The Toto-Baggins",1950,25],["Tough Guy",1700,30],["Tougher Guy",1500,30],["TinyEnemy",1250,1e7]],this._currentStage=0}return _createClass(t,[{key:"update",value:function(t){this.updateTimer(t)&&this.spawnEnemy()}},{key:"updateTimer",value:function(t){return this._elapsed+=t,this._spawnEnemyRate=this._stages[this._currentStage][1],!(this._elapsed<this._spawnEnemyRate)&&(this._elapsed-=this._spawnEnemyRate,!0)}},{key:"spawnEnemy",value:function(){if(0==--this._stages[this._currentStage][2])return this._currentStage++,void(this._elapsed=-5e3);this._game._enemies.push(this._em.generateEnemy(this._stages[this._currentStage][0]))}}]),t}(),EnemyFactory=function(){function t(e){_classCallCheck(this,t),this._base={posx:0,posy:0,velx:0,vely:0,target:e},this.Begin={name:"Begin"},this.Sheep={speed:10,damage:1,health:5,money:.5},this.Wolf={speed:15,damage:1.5,health:15,money:1},this.Unicorn={speed:20,damage:2,health:20,money:1},this.Sealion={speed:20,damage:2.5,health:25,money:1},this.Bear={speed:20,damage:3,health:30,money:2},this["Armored Bear"]={speed:25,damage:3,health:50,money:2},this["Small Enemy"]={speed:25,damage:5,health:60,money:2.5},this["Feisty Enemy"]={speed:25,damage:5,health:65,money:2.5},this.Gorgon={speed:27,damage:5,health:70,money:2.5},this.Cyclops={speed:30,damage:5,health:75,money:2.5},this.Titan={speed:31,damage:5,health:80,money:2.8},this["Little Sister"]={speed:35,damage:5.5,health:70,money:4},this["The Dinyyen"]={speed:40,damage:5,health:100,money:2.8},this["The Toto-Baggins"]={speed:45,damage:5,health:105,money:2.8},this["Tough Guy"]={speed:45,damage:5,health:105,money:2.8},this["Tougher Guy"]={speed:45,damage:5,health:150,money:2.8},this.TinyEnemy={speed:45,damage:5,health:160,money:2.8}}return _createClass(t,[{key:"generateEnemy",value:function(t){this[t]||(t="Sheep");var e={name:t},n=!0,i=!1,s=void 0;try{for(var o,r=Object.keys(this._base)[Symbol.iterator]();!(n=(o=r.next()).done);n=!0)e[_=o.value]=this._base[_]}catch(t){i=!0,s=t}finally{try{!n&&r.return&&r.return()}finally{if(i)throw s}}var a=!0,h=!1,l=void 0;try{for(var c,u=Object.keys(this[t])[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var _=c.value;e[_]=this[t][_]}}catch(t){h=!0,l=t}finally{try{!a&&u.return&&u.return()}finally{if(h)throw l}}return new HomingBullet(e.posx,e.posy,e.velx,e.vely,e.target,e.speed,e.damage,e.health,e.money,e.name)}}]),t}();